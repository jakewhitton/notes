#!/bin/bash

usage() {
	echo "Incorrect usage."
	echo "Usage: genmaster <PERIOD_DIRECTORY> <UNIT_DIRECTORY>"
	exit 0;
}

CURRENTGRADE="12"

if [[ -z $1 || -z $2 ]]
then
	usage
fi

pwd="`pwd`"

cd /home/jake/notes/"$CURRENTGRADE"/"$1"_*/"$2"_*

if [ -e ./master.md ]; then
	echo "" > ./master.md
else
	touch master.md
fi

for file in `ls . | sed 's/\master.md//g' | sed 's/\master.pdf//g'` ; do
	[[ -e $file ]] || continue
	
	echo "Processing $file..."
	echo -e "# $(echo $file | sed 's/\.md//g')\n" >> ./master.md
	cat $file >> ./master.md
	echo -e "\n\n---\n\n" >> ./master.md
	
done

#Remove leading newline
sed -i '1d' ./master.md

#Remove trailing newlines and divider
sed -i '$ d' ./master.md
sed -i '$ d' ./master.md
sed -i '$ d' ./master.md
sed -i '$ d' ./master.md
sed -i '$ d' ./master.md

echo "Generating master pdf"
pandoc -s -f markdown -o master.pdf --latex-engine=pdflatex master.md

cd "$pwd"
